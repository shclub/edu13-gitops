apiVersion: apps/v1
kind: Deployment

metadata:
  name: icis-apigw-deployment
  namespace: sa-app
spec:
  replicas: 1
  selector:
    matchLabels:
      app: icis-apigw
  template:
    metadata:
      annotations:
        sidecar.istio.io/inject: "true"    
      labels:
        app: icis-apigw
    spec:
      containers:
      - name: icis-apigw
        image: nexus.dspace.kt.co.kr/icis/icis-apigw
        ports:
        - name: http
          containerPort: 8800
        resources:
          limits:
            cpu: '0.5'
            memory: 1Gi
        env:
          - name: NODE_IP
            valueFrom:
              fieldRef:
                apiVersion: v1
                fieldPath: status.hostIP
          - name: POD_IP
            valueFrom:
              fieldRef:
                apiVersion: v1
                fieldPath: status.podIP
          - name: NODE_NAME
            valueFrom:
              fieldRef:
                apiVersion: v1
                fieldPath: spec.nodeName
          - name: POD_NAME
            valueFrom:
              fieldRef:
                apiVersion: v1
                fieldPath: metadata.name
        envFrom:
        - configMapRef:
            name: icis-apigw-configmap  
  minReadySeconds: 30
  revisionHistoryLimit: 3
  strategy:
    type: RollingUpdate
